好。先把“**实验任务表**”一次性给全，按你定的五组实验（K、Q、K→Q、P、消融）拆成可直接执行的任务清单。所有口径已统一：**512×512、BS=1、pair-graph K=4、seed=42**。日志字段固定（质量/效率/资源/成本）。

# DUSt3R 轻量化—实验任务表（V1）

## 0) 总阶段与里程碑

| 阶段ID | 模块       | 目标                    | 产出                                         | 预计GPU时长 | 依赖    |
| ---- | -------- | --------------------- | ------------------------------------------ | ------- | ----- |
| P0   | Baseline | 跑通Teacher与评测口径        | `teacher_eval.json`                        | 4–6h    | —     |
| P1   | K-only   | 训稳学生FP32（跌幅≤1%）       | `student_fp32_best.pth`、`distill_log.json` | 32–48h  | P0    |
| P2   | Q-only   | INT8引擎（keep-list）     | `quantized_model.trt`、`quant_eval.json`    | 12–20h  | P0    |
| P3   | K→Q      | 工程主线联合（精度≤1%，时延↓≥50%） | `student_int8.trt`、`kq_eval.json`          | 12–20h  | P1    |
| P4   | P-only   | 结构化剪枝两档（ρ=0.1/0.3）    | `pruned_*.pth`、`prune_eval.json`           | 20–30h  | P0    |
| P5   | 消融       | 2–3组关键消融              | `ablation_*.json`                          | 6–12h   | P1/P2 |

> 统一日志字段：`exp_id, combo, rho, T, beta, gamma, bits_w, bits_a, keep_list, params_M, flops_G, size_MB, vram_GB, chamfer, absrel, rmse, delta1, t_pair_p50_ms, t_pair_p95_ms, t_scene_s, pairs_per_sec, gpu_hours, notes, seed, datetime`

---

## 1) P0 Baseline（必须先做）

| 任务ID | 步骤        | 操作要点                   | 产出                  | 判定/止损       | 预计GPU |
| ---- | --------- | ---------------------- | ------------------- | ----------- | ----- |
| P0-1 | 数据/口径固定   | 采样20对图；固定K=4配对；seed=42 | `workload.yaml`     | 规范完成        | 0h    |
| P0-2 | Teacher评测 | 跑质量/效率/资源三类指标          | `teacher_eval.json` | 指标无NaN；日志完整 | 4–6h  |

---

## 2) P1 K-only（轻量蒸馏）

**配置**：Student降深度/heads/FFN各≈30%；损失 (L=αL_{task}+β,KL+γ|F_T!-!F_S|^2)

| 任务ID | 步骤        | 关键参数                          | 产出                       | 判定/止损        | 预计GPU |
| ---- | --------- | ----------------------------- | ------------------------ | ------------ | ----- |
| K-1  | 启动网格1     | T=3, β=0.5, γ=0, 30epoch, 早停3 | `student_fp32_t3b05.pth` | 主指标跌幅≤1%；否则停 | 8–12h |
| K-2  | 网格2       | T=5, β=0.5, γ=0               | `student_fp32_t5b05.pth` | 同上           | 8–12h |
| K-3  | 网格3（后期提β） | 前70%β=0.5→后30%β=0.7           | `student_fp32_sched.pth` | 曲线稳定         | 8–12h |
| K-4  | 复评        | 三模型统一评测口径                     | `distill_log.json`       | 选best        | 2–4h  |

---

## 3) P2 Q-only（量化，PTQ→QAT）

**策略**：W8A8；权重per-channel、激活per-tensor；**keep-list**：Softmax/Attn-scale/LayerNorm 保FP16；校准≥512张

| 任务ID | 步骤    | 关键参数                | 产出                    | 判定/止损           | 预计GPU |
| ---- | ----- | ------------------- | --------------------- | --------------- | ----- |
| Q-1  | PTQ校准 | calib=512           | `ptq_int8.onnx`       | 掉点>1%→QAT       | 2–3h  |
| Q-2  | QAT训练 | 10–15epoch；后⅓打开量化感知 | `quant_ckpt.pth`      | 掉点≤1%           | 6–10h |
| Q-3  | TRT导出 | 静态shape 1×3×512×512 | `quantized_model.trt` | 可推理             | 2–3h  |
| Q-4  | 评测    | 统一口径                | `quant_eval.json`     | t_pair p50↓≥50% | 2–4h  |

---

## 4) P3 K→Q（主线联合）

| 任务ID | 步骤      | 关键参数             | 产出                 | 判定/止损         | 预计GPU |
| ---- | ------- | ---------------- | ------------------ | ------------- | ----- |
| KQ-1 | 选best学生 | 来自P1（K-1~K-3）    | —                  | 精度最优          | —     |
| KQ-2 | QAT     | 复用P2策略与keep-list | `student_int8.trt` | 掉点≤1%；时延↓≥50% | 8–12h |
| KQ-3 | 评测      | 统一口径             | `kq_eval.json`     | 通过阈值          | 2–4h  |

---

## 5) P4 P-only（结构化剪枝）

**策略**：通道/Head/FFN维度结构化剪；L1重要度+依赖图/敏感度；两档即可

| 任务ID | 步骤      | 档位           | 产出                | 判定/止损    | 预计GPU  |
| ---- | ------- | ------------ | ----------------- | -------- | ------ |
| P-1  | 剪枝ρ=0.1 | 微调10–15epoch | `pruned_r010.pth` | 跌幅≤3%    | 8–12h  |
| P-2  | 剪枝ρ=0.3 | 微调10–15epoch | `pruned_r030.pth` | 跌幅≤3%否则停 | 10–14h |
| P-3  | 评测      | 统一口径         | `prune_eval.json` | 体积↓≥25%  | 2–4h   |

---

## 6) P5 消融（至少2–3组）

| 任务ID  | 主题        | 设置                    | 产出                    | 目的      | 预计GPU |
| ----- | --------- | --------------------- | --------------------- | ------- | ----- |
| ABL-1 | keep-list | 去掉LN / 去掉Softmax（分别测） | `ablation_keep.json`  | 量化稳定性证据 | 2–3h  |
| ABL-2 | 校准规模      | calib=128/256/512 对比  | `ablation_calib.json` | 校准敏感性   | 2–3h  |
| ABL-3 | 蒸馏损失      | 仅KL vs KL+FD(γ=0.1)   | `ablation_loss.json`  | K的贡献    | 2–4h  |

---

## 7) 统一命名 & 交付清单

* **exp_id**：`{stage}_{combo}_{keyparams}_{run}`
  例：`K_T3B05_sched_run1`、`Q_QAT_keepLN_run1`、`KQ_INT8_run1`、`P_r010_run1`
* **产出文件**：
  `*.pth / *.onnx / *.trt / *_eval.json / *_log.json / result_table.csv`
* **成功线（硬性）**：

  * K：主质量跌幅 ≤ **1%**
  * Q/K→Q：跌幅 ≤ **1%**，**t_pair p50** 相对学生FP32 **↓ ≥50%**
  * P：Size/Params **↓ ≥25%**，跌幅 ≤ **3%**

---

## 8) 依赖与优先级（跑顺序）

1. **P0 → P1 → P3**（主线）
2. 并行 **P2**（Q-only，用于对照）
3. 充裕时做 **P4（P-only）** 与 **P5（消融）**

---

## 9) 每日执行单模板（贴到你的记录表即可）

| 日期    | 任务ID | 输入/配置                     | 产出                       | 判定 | GPUh | 备注   |
| ----- | ---- | ------------------------- | ------------------------ | -- | ---- | ---- |
| 10/08 | P0-2 | `workload.yaml`           | `teacher_eval.json`      | ✅  | 4.5  | —    |
| 10/09 | K-1  | `distill.yaml(T=3,β=0.5)` | `student_fp32_t3b05.pth` | 🔄 | 10   | 收敛正常 |

---

> 下一步：你说“文件结构”和“配置模板”。我可以在你的下一条消息里直接给出：
>
> * 目录树 + 必备脚本名
> * `distill.yaml / quant.yaml / prune.yaml / workload.yaml` 四个可用模板（含关键参数位点）。
